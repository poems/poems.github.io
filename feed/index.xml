<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[POEMS]]></title>
  <link href="http://poems.github.io/feed" rel="self"/>
  <link href="http://poems.github.io/"/>
  <updated>2013-12-08T02:27:36+00:00</updated>
  <id>http://poems.github.io/</id>
  <author>
    <name><![CDATA[Pieux Xi]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[NOTE: Everything about CAS]]></title>
    <link href="http://poems.github.io/blog/2013/12/08/note-everything-about-cas/"/>
    <updated>2013-12-08T02:12:00+00:00</updated>
    <id>http://poems.github.io/blog/2013/12/08/note-everything-about-cas</id>
    <content type="html"><![CDATA[<p>假设 CAS Server 的域名是 cas.server.com</p>

<p>CAS Server 的 webapp 是 spring web flow，登陆地址为：<a href="https://cas.%EF%BB%BFserver.com/cas/login">https://cas.%EF%BB%BFserver.com/cas/login</a></p>

<p>登出地址为：<a href="https://cas.server.com/cas/logout">https://cas.server.com/cas/logout</a></p>

<p>语言参数为：locale=zh_CN，locale=en</p>

<p>除了配置 CAS Server 和 Client 外，需要配置环境，包括生成和导出导入证书，Tomcat配置SSL等。</p>

<h2>CAS Server</h2>

<h3>原理（认证流程）</h3>

<p><img src="http://i.imgur.com/MDSRTIc.jpg" alt="CAS 基本模式" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Maven Archetype Plugin]]></title>
    <link href="http://poems.github.io/blog/2013/12/08/maven-archetype-plugin/"/>
    <updated>2013-12-08T01:31:00+00:00</updated>
    <id>http://poems.github.io/blog/2013/12/08/maven-archetype-plugin</id>
    <content type="html"><![CDATA[<h2>Struts 2 Maven Archetype</h2>

<h3>The Blank Archetype (struts2-archetype-blank)</h3>

<h3>The Starter Archetype (struts2-archetype-starter)</h3>

<p>Compared to the former, it adds more features like &ldquo;Spring Integration&rdquo;.</p>

<h3>The Blank Convention Archetype (struts2-archetype-convention)</h3>

<p>Features like &ldquo;Convention-based validation&rdquo;, &ldquo;GAE aware&rdquo;.</p>

<h2>Creating an Application Using a Maven Archetyp</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mvn archetype:generate -B \
</span><span class='line'>                       -DgroupId=tutorial \
</span><span class='line'>                       -DartifactId=tutorial \
</span><span class='line'>                       -DarchetypeGroupId=org.apache.struts \
</span><span class='line'>                       -DarchetypeArtifactId=struts2-archetype-blank \
</span><span class='line'>                       -DarchetypeVersion=&lt;version&gt;</span></code></pre></td></tr></table></div></figure>


<p>If the above command will fail because of missing archetypes in central repository, you can try to use staging repository like below</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mvn archetype:generate -DarchetypeCatalog=http://people.apache.org/builds/struts/&lt;version&gt;/m2-staging-repository/</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NOTE: CAS Java Client]]></title>
    <link href="http://poems.github.io/blog/2013/12/05/note-cas-java-client/"/>
    <updated>2013-12-05T08:43:00+00:00</updated>
    <id>http://poems.github.io/blog/2013/12/05/note-cas-java-client</id>
    <content type="html"><![CDATA[<h1>CAS Client for Java 3.1</h1>

<h2>通过 web.xml 配置 Jasig CAS Client for Java</h2>

<p>CAS Client for Java 3.1/3.2 可以通过配置 web.xml 里的 context-params 和 filter init-params。每个 filter 都需要配置一系列的属性（properties）。filters 会查找这些属性：</p>

<ol>
<li>首先检查 filter 的本地 init-params（local init-params），看是否有相符合的属性名；</li>
<li>其次检查 context 的参数 ，看是否有相符合的属性名；</li>
</ol>


<p>如果在 filter 的 init-params 和 context 的参数中找到相同的值，则选用 init-params。</p>

<p>同样，filter 的顺序为：</p>

<ol>
<li>SingleLogOutFilter (if you&rsquo;re using it)</li>
<li>AuthenticationFilter</li>
<li>TicketValidationFilter (whichever one is chosen)</li>
<li>HttpServletRequestWrapperFilter</li>
<li>AssertionThreadLocalFilter</li>
</ol>


<blockquote><p>! 如果使用 serverName 属性，请注意 fragment-URL(#后的 URL)不会发送给服务器。</p></blockquote>

<p>一一介绍可用的 filters:</p>

<h3>org.jasig.cas.client.authentication.AuthenticationFilter</h3>

<p>AuthenticationFilter 判断一个用户是否需要验证。如果需要，则重定向到 CAS server。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;filter&gt;
</span><span class='line'>  &lt;filter-name&gt;CAS Authentication Filter&lt;/filter-name&gt;
</span><span class='line'>  &lt;filter-class&gt;org.jasig.cas.client.authentication.AuthenticationFilter&lt;/filter-class&gt;
</span><span class='line'>  &lt;init-param&gt;
</span><span class='line'>    &lt;!--cas server login url--&gt;
</span><span class='line'>    &lt;param-name&gt;casServerLoginUrl&lt;/param-name&gt;
</span><span class='line'>    &lt;param-value&gt;https://battags.ad.ess.rutgers.edu:8443/cas/login&lt;/param-value&gt;
</span><span class='line'>  &lt;/init-param&gt;
</span><span class='line'>  &lt;init-param&gt;
</span><span class='line'>    &lt;!--cas server name--&gt;
</span><span class='line'>    &lt;param-name&gt;serverName&lt;/param-name&gt;
</span><span class='line'>    &lt;param-value&gt;http://www.acme-client.com&lt;/param-value&gt;
</span><span class='line'>  &lt;/init-param&gt;
</span><span class='line'>&lt;/filter&gt;</span></code></pre></td></tr></table></div></figure>


<p><strong>Required Properties</strong></p>

<ul>
<li>casServerLoginUrl: CAS server 的登录页地址，i.e. <a href="https://localhost:8443/cas/login">https://localhost:8443/cas/login</a></li>
<li>service or serverName

<ul>
<li>service: 发送给 CAS server 的服务的 URL，e.g. <a href="https://localhost:8443/yourwebapp/index.html">https://localhost:8443/yourwebapp/index.html</a></li>
<li>serverName: 应用部署的服务器名。service URL 会据此动态生成。i.e. <a href="https://localhost:8443">https://localhost:8443</a> (需要指定协议，如果是标准端口，则端口可隐式)。</li>
</ul>
</li>
</ul>


<p><strong>Optional Properties</strong>:</p>

<p>有 <em>renew</em>, <em>gateway</em>, <em>artifactParameterName</em>, <em>serviceParameterName</em>。</p>

<h3>org.jasig.cas.client.authentication.Saml11AuthenticationFilter</h3>

<p>猜测是支持 SAML 1.1 的 authentication filter。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;filter&gt;
</span><span class='line'>  &lt;filter-name&gt;CAS Authentication Filter&lt;/filter-name&gt;
</span><span class='line'>  &lt;filter-class&gt;org.jasig.cas.client.authentication.AuthenticationFilter&lt;/filter-class&gt;
</span><span class='line'>  &lt;init-param&gt;
</span><span class='line'>    &lt;param-name&gt;casServerLoginUrl&lt;/param-name&gt;
</span><span class='line'>    &lt;param-value&gt;https://battags.ad.ess.rutgers.edu:8443/cas/login&lt;/param-value&gt;
</span><span class='line'>  &lt;/init-param&gt;
</span><span class='line'>  &lt;init-param&gt;
</span><span class='line'>    &lt;param-name&gt;serverName&lt;/param-name&gt;
</span><span class='line'>    &lt;param-value&gt;http://www.acme-client.com&lt;/param-value&gt;
</span><span class='line'>  &lt;/init-param&gt;
</span><span class='line'>&lt;/filter&gt;</span></code></pre></td></tr></table></div></figure>


<h3>org.jasig.cas.client.validation.Saml11TicketValidationFilter</h3>

<p>使用 SAML 1.1 协议验证 tickets。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;filter&gt;
</span><span class='line'>  &lt;filter-name&gt;CAS Validation Filter&lt;/filter-name&gt;
</span><span class='line'>  &lt;filter-class&gt;org.jasig.cas.client.validation.Saml11TicketValidationFilter&lt;/filter-class&gt;
</span><span class='line'>  &lt;init-param&gt;
</span><span class='line'>    &lt;param-name&gt;casServerUrlPrefix&lt;/param-name&gt;
</span><span class='line'>    &lt;param-value&gt;https://battags.ad.ess.rutgers.edu:8443/cas&lt;/param-value&gt;
</span><span class='line'>  &lt;/init-param&gt;
</span><span class='line'>  &lt;init-param&gt;
</span><span class='line'>    &lt;param-name&gt;serverName&lt;/param-name&gt;
</span><span class='line'>    &lt;param-value&gt;http://www.acme-client.com&lt;/param-value&gt;
</span><span class='line'>  &lt;/init-param&gt;
</span><span class='line'> &lt;/filter&gt;</span></code></pre></td></tr></table></div></figure>


<p><strong>Required Properties</strong></p>

<ul>
<li>casServerUrlPrefix: CAS 服务器的URL起始页，i.e. <a href="https://localhost:8443/cas">https://localhost:8443/cas</a></li>
<li>serverName or service: 同上</li>
</ul>


<p><strong>Optional Properties</strong></p>

<ul>
<li>redirectAfterValidation (default: true)</li>
<li>useSession (default: true)</li>
<li>exceptionOnValidationFailure (default: true)</li>
<li>tolerance (default: 1000 mSec)</li>
<li>renew (default: false)</li>
</ul>


<h3>org.jasig.cas.client.util.HttpServletRequestWrapperFilter</h3>

<p>Wraps an HttpServletRequest so that the getRemoteUser and getPrincipal return the CAS related entries.</p>

<p>包裹 HttpServletRequest，使 getRemoteUser 和 getPrincipal 返回 CAS 相关的入口。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;filter&gt;
</span><span class='line'>  &lt;filter-name&gt;CAS HttpServletRequest Wrapper Filter&lt;/filter-name&gt;
</span><span class='line'>  &lt;filter-class&gt;org.jasig.cas.client.util.HttpServletRequestWrapperFilter&lt;/filter-class&gt;
</span><span class='line'>&lt;/filter&gt;</span></code></pre></td></tr></table></div></figure>


<p><strong>Required Properties</strong></p>

<p>None</p>

<p><strong>Optional Properties</strong></p>

<p>None</p>

<h3>org.jasig.cas.client.util.AssertionThreadLocalFilter</h3>

<p>Places the Assertion in a ThreadLocal for portions of the application that need access to it. This is useful when the Web application that this filter &ldquo;fronts&rdquo; needs to get the Principal name, but it has no access to the HttpServletRequest, hence making getRemoteUser() call impossible.</p>

<p>把这个 Assertion 放进 ThreadLocal 中，因为有些应用可能需要。比如：当 Web 应用需要拿到 Principal 的名字，但是它无法访问 HttpServletRequest，因此 getRemoteUser() 没有用。</p>

<blockquote><p>! 没搞懂什么意思，猜测是 CAS Client 应用想要拿到登陆的用户名，但是用户名存储在 CAS Server 上。这个 filter 的作用就是把 Principal 放到 ThreadLocal 变量中。</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;filter&gt;
</span><span class='line'>  &lt;filter-name&gt;CAS Assertion Thread Local Filter&lt;/filter-name&gt;
</span><span class='line'>  &lt;filter-class&gt;org.jasig.cas.client.util.AssertionThreadLocalFilter&lt;/filter-class&gt;
</span><span class='line'>&lt;/filter&gt;</span></code></pre></td></tr></table></div></figure>


<p>e.g. 一份稍完整的 CAS Client for Java 的 web.xml（未使用 SAML 1.1，为 CAS 协议）</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
</span><span class='line'>&lt;web-app xmlns="http://java.sun.com/xml/ns/j2ee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
</span><span class='line'>    xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"
</span><span class='line'>    version="2.4"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;display-name&gt;CAS client demo : application&lt;/display-name&gt;
</span><span class='line'>
</span><span class='line'>    &lt;filter&gt;
</span><span class='line'>        &lt;!--配置 AuthenticationFilter--&gt;
</span><span class='line'>        &lt;filter-name&gt;CAS Authentication Filter&lt;/filter-name&gt;
</span><span class='line'>        &lt;filter-class&gt;org.jasig.cas.client.authentication.AuthenticationFilter&lt;/filter-class&gt;
</span><span class='line'>        &lt;init-param&gt;
</span><span class='line'>            &lt;!--property: 登陆页配置--&gt;
</span><span class='line'>            &lt;param-name&gt;casServerLoginUrl&lt;/param-name&gt;
</span><span class='line'>            &lt;param-value&gt;http://localhost:8080/cas/login&lt;/param-value&gt;
</span><span class='line'>        &lt;/init-param&gt;
</span><span class='line'>        &lt;init-param&gt;
</span><span class='line'>            &lt;!--property: 部署服务器地址--&gt;
</span><span class='line'>            &lt;param-name&gt;serverName&lt;/param-name&gt;
</span><span class='line'>            &lt;param-value&gt;http://localhost:8080&lt;/param-value&gt;
</span><span class='line'>        &lt;/init-param&gt;
</span><span class='line'>        &lt;!-- init-param&gt;
</span><span class='line'>            &lt;param-name&gt;service&lt;/param-name&gt;
</span><span class='line'>            &lt;param-value&gt;http://localhost:8080/default.jsp&lt;/param-value&gt;
</span><span class='line'>        &lt;/init-param--&gt;
</span><span class='line'>    &lt;/filter&gt;
</span><span class='line'>
</span><span class='line'>    &lt;filter&gt;
</span><span class='line'>        &lt;filter-name&gt;CAS Validation Filter&lt;/filter-name&gt;
</span><span class='line'>        &lt;filter-class&gt;org.jasig.cas.client.validation.Cas10TicketValidationFilter&lt;/filter-class&gt;
</span><span class='line'>        &lt;init-param&gt;
</span><span class='line'>            &lt;param-name&gt;casServerUrlPrefix&lt;/param-name&gt;
</span><span class='line'>            &lt;param-value&gt;http://localhost:8080/cas&lt;/param-value&gt;
</span><span class='line'>        &lt;/init-param&gt;
</span><span class='line'>        &lt;init-param&gt;
</span><span class='line'>            &lt;param-name&gt;serverName&lt;/param-name&gt;
</span><span class='line'>            &lt;param-value&gt;http://localhost:8080&lt;/param-value&gt;
</span><span class='line'>        &lt;/init-param&gt;
</span><span class='line'>    &lt;/filter&gt;
</span><span class='line'>
</span><span class='line'>    &lt;filter-mapping&gt;
</span><span class='line'>        &lt;filter-name&gt;CAS Authentication Filter&lt;/filter-name&gt;
</span><span class='line'>        &lt;url-pattern&gt;/protected/*&lt;/url-pattern&gt;
</span><span class='line'>    &lt;/filter-mapping&gt;
</span><span class='line'>
</span><span class='line'>    &lt;filter-mapping&gt;
</span><span class='line'>        &lt;filter-name&gt;CAS Validation Filter&lt;/filter-name&gt;
</span><span class='line'>        &lt;url-pattern&gt;*&lt;/url-pattern&gt;
</span><span class='line'>    &lt;/filter-mapping&gt;
</span><span class='line'>
</span><span class='line'>&lt;/web-app&gt;</span></code></pre></td></tr></table></div></figure>


<p>e.g. 使用 SAML 1.1</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
</span><span class='line'>&lt;web-app xmlns="http://java.sun.com/xml/ns/j2ee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
</span><span class='line'>  xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"
</span><span class='line'>  version="2.4"&gt;
</span><span class='line'>
</span><span class='line'>  &lt;display-name&gt;CAS client demo : application&lt;/display-name&gt;
</span><span class='line'>
</span><span class='line'>  &lt;filter&gt;
</span><span class='line'>      &lt;filter-name&gt;CAS Authentication Filter&lt;/filter-name&gt;
</span><span class='line'>      &lt;filter-class&gt;org.jasig.cas.client.authentication.Saml11AuthenticationFilter&lt;/filter-class&gt;
</span><span class='line'>      &lt;init-param&gt;
</span><span class='line'>          &lt;param-name&gt;casServerLoginUrl&lt;/param-name&gt;
</span><span class='line'>          &lt;param-value&gt;http://localhost:8080/cas/login&lt;/param-value&gt;
</span><span class='line'>      &lt;/init-param&gt;
</span><span class='line'>      &lt;init-param&gt;
</span><span class='line'>          &lt;param-name&gt;serverName&lt;/param-name&gt;
</span><span class='line'>          &lt;param-value&gt;http://localhost:8080&lt;/param-value&gt;
</span><span class='line'>      &lt;/init-param&gt;
</span><span class='line'>      &lt;init-param&gt;
</span><span class='line'>          &lt;param-name&gt;onlyFullyAuthenticated&lt;/param-name&gt;
</span><span class='line'>            &lt;param-value&gt;true&lt;/param-value&gt;
</span><span class='line'>        &lt;/init-param&gt;
</span><span class='line'>  &lt;/filter&gt;
</span><span class='line'>
</span><span class='line'>  &lt;filter&gt;
</span><span class='line'>      &lt;filter-name&gt;CAS Validation Filter&lt;/filter-name&gt;
</span><span class='line'>      &lt;filter-class&gt;org.jasig.cas.client.validation.Saml11TicketValidationFilter&lt;/filter-class&gt;
</span><span class='line'>      &lt;init-param&gt;
</span><span class='line'>          &lt;param-name&gt;casServerUrlPrefix&lt;/param-name&gt;
</span><span class='line'>          &lt;param-value&gt;http://localhost:8080/cas&lt;/param-value&gt;
</span><span class='line'>      &lt;/init-param&gt;
</span><span class='line'>      &lt;init-param&gt;
</span><span class='line'>          &lt;param-name&gt;serverName&lt;/param-name&gt;
</span><span class='line'>          &lt;param-value&gt;http://localhost:8080&lt;/param-value&gt;
</span><span class='line'>      &lt;/init-param&gt;
</span><span class='line'>  &lt;/filter&gt;
</span><span class='line'>
</span><span class='line'>  &lt;filter-mapping&gt;
</span><span class='line'>      &lt;filter-name&gt;CAS Authentication Filter&lt;/filter-name&gt;
</span><span class='line'>      &lt;url-pattern&gt;/protected/*&lt;/url-pattern&gt;
</span><span class='line'>  &lt;/filter-mapping&gt;
</span><span class='line'>
</span><span class='line'>  &lt;filter-mapping&gt;
</span><span class='line'>      &lt;filter-name&gt;CAS Validation Filter&lt;/filter-name&gt;
</span><span class='line'>      &lt;url-pattern&gt;*&lt;/url-pattern&gt;
</span><span class='line'>  &lt;/filter-mapping&gt;
</span><span class='line'>
</span><span class='line'>&lt;/web-app&gt;</span></code></pre></td></tr></table></div></figure>


<h2>配置单点登出 Single Sign Out</h2>

<blockquote><p>! <em>SingleSignOutFilter</em> 会影响到 character encoding。建议显式地配置下 <a href="http://code.google.com/p/vt-middleware/wiki/vtservletfilters#CharacterEncodingFilter">VT Character Encoding Filter</a> 或 <a href="http://static.springsource.org/spring/docs/2.0.x/api/org/springframework/web/filter/CharacterEncodingFilter.html">Spring Character Encoding Filter</a>。</p></blockquote>

<p>CAS 对 Single Sign Out support 的支持，涉及到对一个 filter 和一个 ContextListener 的配置。需要注意的一点是，如果以 Web filters 的形式为 Java 配置 CAS Client，登出的 filter 需要在其他 filters 前面。</p>

<p><strong>PS</strong>: Order of Required Filters <a href="https://wiki.jasig.org/display/CASC/CAS+Client+for+Java+3.1">全文链接</a>
Order of Required Filters</p>

<p>How to configure the filters is described on the pages above. This section details the order in which the filters should appear:</p>

<ol>
<li>SingleLogOutFilter (if you&rsquo;re using it)</li>
<li>AuthenticationFilter</li>
<li>TicketValidationFilter (whichever one is chosen)</li>
<li>HttpServletRequestWrapperFilter</li>
<li>AssertionThreadLocalFilter</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;listenerclass&gt;
</span><span class='line'>  org.jasig.cas.client.session.SingleSignOutHttpSessionListener&lt;/listener-class&gt;
</span><span class='line'>&lt;/listener&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NOTE: Special Things about CAS]]></title>
    <link href="http://poems.github.io/blog/2013/12/05/note-special-things-about-cas/"/>
    <updated>2013-12-05T02:49:00+00:00</updated>
    <id>http://poems.github.io/blog/2013/12/05/note-special-things-about-cas</id>
    <content type="html"><![CDATA[<h1>1</h1>

<p><strong>Create the Certificate</strong></p>

<p>打开终端，进到 home 目录，运行命令：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>keytool -genkey -alias tomcat -keyalg RSA -validity 365</span></code></pre></td></tr></table></div></figure>


<p>需要输入：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Enter keystore password:
</span><span class='line'>Re-enter new password:
</span><span class='line'>What is your first and last name?
</span><span class='line'>  [Unknown]:  $REPLACE_WITH_FULL_MACHINE_NAME
</span><span class='line'>What is the name of your organizational unit?
</span><span class='line'>  [Unknown]:  Test
</span><span class='line'>What is the name of your organization?
</span><span class='line'>  [Unknown]:  Test
</span><span class='line'>What is the name of your City or Locality?
</span><span class='line'>  [Unknown]:  Test
</span><span class='line'>What is the name of your State or Province?
</span><span class='line'>  [Unknown]:  Test
</span><span class='line'>What is the two-letter country code for this unit?
</span><span class='line'>  [Unknown]:  US
</span><span class='line'>Is CN=$FULL_MACHINE_NAME, OU=Test, O=Test, L=Test, ST=Test, C=US correct?
</span><span class='line'>  [no]:  yes</span></code></pre></td></tr></table></div></figure>


<p>如何给这些值？</p>

<p>For the keystore password you should enter &ldquo;changeit&rdquo; without the quotation marks. When prompted for the first and last name, you should enter your machine name during development. The rest of the data does not matter. Then obviously answer &ldquo;yes&rdquo; to the question of whether it&rsquo;s correct.</p>

<blockquote><p>注意： CAS 协议需要走 HTTPS，为了保证能够工作， &ldquo;first and last name&rdquo; 为 $FULL_MACHINE_NAME。Mac 上获取计算机全名的方法是：<code>scutil --get ComputerName</code> 或者 <code>scutil --get LocalHostName</code>。</p></blockquote>

<p>下一步，打开 <code>$TOMCAT_HOME/conf/server.xml</code>，找到这一块，去掉注释即可：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!--
</span><span class='line'>&lt;Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true"
</span><span class='line'>    maxThreads="150" scheme="https" secure="true"
</span><span class='line'>    clientAuth="false" sslProtocol="TLS" /&gt;
</span><span class='line'>--&gt;</span></code></pre></td></tr></table></div></figure>


<p>重启 Tomcat，访问</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>https://$FULL_MACHINE_NAME:8443/</span></code></pre></td></tr></table></div></figure>


<p>Any application that wishes to securely connect to this Tomcat instance would need to import the certificate. You can export the certificate that&rsquo;s compatible with other JVM keystores by executing the following command:</p>

<p>所有想访问该 Tomcat 实例的应用都需要导入证书。首先导出证书，需要输入 keystore 的密码，这里就是 changeit：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>keytool -export -alias tomcat -file server.crt</span></code></pre></td></tr></table></div></figure>


<p>输出是：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Enter keystore password:
</span><span class='line'>Certificate stored in file &lt;server.crt&gt;</span></code></pre></td></tr></table></div></figure>


<p>You can then import the server.crt into other JVM keystore&rsquo;s by executing a command similar to this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>keytool -import -file server.crt -keystore $JAVA_HOME/jre/lib/security/cacerts -alias tomcat</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s recommended that you add it to the JVM keystore of your local development machine to facilitate testing.</p>

<h1>2</h1>

<p><strong>Maven War Overlay</strong><sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup></p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p><a href="https://wiki.jasig.org/display/CASUM/Best+Practice+-+Setting+Up+CAS+Locally+using+the+Maven+WAR+Overlay+Method">Best Practice &ndash; Setting Up CAS Locally using the Maven WAR Overlay Method</a><a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Deploy war to Tomcat]]></title>
    <link href="http://poems.github.io/blog/2013/12/05/deploy-war-to-tomcat/"/>
    <updated>2013-12-05T02:28:00+00:00</updated>
    <id>http://poems.github.io/blog/2013/12/05/deploy-war-to-tomcat</id>
    <content type="html"><![CDATA[<p>非常简单，<code>mvn package</code> 生成的 war 包，直接扔进 Tomcat 安装目录下的 webApps 目录。然后重启下 Tomcat。</p>

<p>不需要任何额外的配置，默认是 localhost:8080/war_name/</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NOTE: Writing GNU Emacs Extensions]]></title>
    <link href="http://poems.github.io/blog/2013/12/04/note-writing-gnu-emacs-extensions/"/>
    <updated>2013-12-04T11:59:00+00:00</updated>
    <id>http://poems.github.io/blog/2013/12/04/note-writing-gnu-emacs-extensions</id>
    <content type="html"><![CDATA[<h1>1￼</h1>

<p><strong>列表处理</strong></p>

<h2>1.1</h2>

<p><strong>Lisp 列表</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>'(rose
</span><span class='line'>  violet
</span><span class='line'>  daisy
</span><span class='line'>  buttercup)</span></code></pre></td></tr></table></div></figure>


<h3>1.1.1</h3>

<p><strong>Lisp 原子</strong></p>

<p><code>()</code> 空列表</p>

<p>空列表既是原子，也是列表</p>

<p>原子和列表都叫做 <strong>符号表达式</strong>(symbolic expression)，简称 s-expression。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Emacs Help Command]]></title>
    <link href="http://poems.github.io/blog/2013/11/30/emacs-help-command/"/>
    <updated>2013-11-30T03:30:00+00:00</updated>
    <id>http://poems.github.io/blog/2013/11/30/emacs-help-command</id>
    <content type="html"><![CDATA[<p>You have typed C-h, the help character.  Type a Help option:
(Use SPC or DEL to scroll through this text.  Type q to exit the Help command.)</p>

<p>常用的是：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>a PATTERN   Show commands whose name matches the PATTERN (a list of words
</span><span class='line'>              or a regexp).  See also the `apropos' command.              
</span><span class='line'>b           Display all key bindings.
</span><span class='line'>c KEYS      Display the command name run by the given key sequence.
</span><span class='line'>C CODING    Describe the given coding system, or RET for current ones.
</span><span class='line'>d PATTERN   Show a list of functions, variables, and other items whose
</span><span class='line'>              documentation matches the PATTERN (a list of words or a regexp).
</span><span class='line'>e           Go to the *Messages* buffer which logs echo-area messages.
</span><span class='line'>f FUNCTION  Display documentation for the given function.
</span><span class='line'>F COMMAND   Show the on-line manual's section that describes the command.
</span><span class='line'>g           Display information about the GNU project.
</span><span class='line'>h           Display the HELLO file which illustrates various scripts.
</span><span class='line'>i           Start the Info documentation reader: read on-line manuals.
</span><span class='line'>I METHOD    Describe a specific input method, or RET for current.
</span><span class='line'>k KEYS      Display the full documentation for the key sequence.
</span><span class='line'>K KEYS      Show the on-line manual's section for the command bound to KEYS.
</span><span class='line'>l           Show last 300 input keystrokes (lossage).
</span><span class='line'>L LANG-ENV  Describes a specific language environment, or RET for current.
</span><span class='line'>m           Display documentation of current minor modes and current major mode,
</span><span class='line'>              including their special commands.
</span><span class='line'>n           Display news of recent Emacs changes.
</span><span class='line'>p TOPIC     Find packages matching a given topic keyword.
</span><span class='line'>r           Display the Emacs manual in Info mode.
</span><span class='line'>s           Display contents of current syntax table, plus explanations.
</span><span class='line'>S SYMBOL    Show the section for the given symbol in the on-line manual
</span><span class='line'>              for the programming language used in this buffer.
</span><span class='line'>t           Start the Emacs learn-by-doing tutorial.
</span><span class='line'>v VARIABLE  Display the given variable's documentation and value.
</span><span class='line'>w COMMAND   Display which keystrokes invoke the given command (where-is).
</span><span class='line'>.           Display any available local help at point in the echo area.
</span><span class='line'>
</span><span class='line'>C-a         Information about Emacs.
</span><span class='line'>C-c         Emacs copying permission (GNU General Public License).
</span><span class='line'>C-d         Instructions for debugging GNU Emacs.
</span><span class='line'>C-e         External packages and information about Emacs.
</span><span class='line'>C-f         Emacs FAQ.
</span><span class='line'>C-m         How to order printed Emacs manuals.
</span><span class='line'>C-n         News of recent Emacs changes.
</span><span class='line'>C-o         Emacs ordering and distribution information.
</span><span class='line'>C-p         Info about known Emacs problems.
</span><span class='line'>C-t         Emacs TODO list.
</span><span class='line'>C-w         Information on absence of warranty for GNU Emacs.
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Emacs Survial with Evil &amp; Family]]></title>
    <link href="http://poems.github.io/blog/2013/11/29/emacs-survial-with-evil-and-family/"/>
    <updated>2013-11-29T23:33:00+00:00</updated>
    <id>http://poems.github.io/blog/2013/11/29/emacs-survial-with-evil-and-family</id>
    <content type="html"><![CDATA[<h1>1 概览</h1>

<h2>1.1 安装 evil</h2>

<p>从网上找到的一个简易的方法，easy to be understood:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(defun require-package (package)
</span><span class='line'>  "Install given PACKAGE."
</span><span class='line'>  (unless (package-installed-p package)
</span><span class='line'>    (unless (assoc package package-archive-contents)
</span><span class='line'>      (package-refresh-contents))
</span><span class='line'>    (package-install package)))</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(require-package 'evil)
</span><span class='line'>(require 'evil)
</span><span class='line'>(evil-mode 1)</span></code></pre></td></tr></table></div></figure>


<h2>1.2 modes and states</h2>

<p>光标上用点颜色，看起来舒服点。红色是退回Emacs（使用<code>C-z</code>，再按一次<code>C-z</code>回到evil），</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(setq evil-emacs-state-cursor '("red" box))
</span><span class='line'>(setq evil-normal-state-cursor '("green" box))
</span><span class='line'>(setq evil-insert-state-cursor '("orange" bar))</span></code></pre></td></tr></table></div></figure>


<blockquote><p>这里有个terminology的区别：vim中的<em>mode</em>指的是Normal, Insert, Visual等，vim是模式编辑器。但是在Emacs中，<em>mode</em>是指对特定文本定义的一组快捷键。所以，evil把vim中的<em>mode</em>称作<em>state</em>。</p></blockquote>

<h1>2 设置</h1>

<p>通过一堆variable设置evil，可以通过 <code>M-x customize-group RET evil RET</code> 查看当前的设置。</p>

<p><code>setq</code>设置全局变量，<code>setq-default</code>设置buffer-local的变量，而且要在evil加载前修改<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(setq evil-shift-width 8) 
</span><span class='line'>;; Load Evil
</span><span class='line'>(require ’evil) . . .</span></code></pre></td></tr></table></div></figure>


<p>下面列出的variable，基本上默认值和vim的行为类似，但是<em>evil-want-C-u-scroll</em>默认不是t。</p>

<p><em>evil-auto-indent</em> [Variable]</p>

<blockquote><p>t(default), nil，类似vim中的autoindent。</p></blockquote>

<p><em>evil-shift-width</em> [Variable]</p>

<blockquote><p>The number of columns a line is shifted by the commands > and &lt;.</p></blockquote>

<p><em>evil-repeat-move-cursor</em> [Variable]</p>

<blockquote><p>如果t(default)，使用<code>.</code>重复时光标改变位置。</p></blockquote>

<p><em>evil-find-skip-newlines</em> [Variable]</p>

<blockquote><p>如果t，那么<em>f</em>，<em>F</em>，<em>t</em>，<em>T</em>会查找到其他行。nil(default)。</p></blockquote>

<p><em>evil-move-cursor-back</em> [Variable]</p>

<blockquote><p>t(default)，和vim的行为类似，退出insert state时，光标前移一格。</p></blockquote>

<p><em>evil-want-fine-undo</em> [Variable]</p>

<blockquote><p>If t, then a change-based action like cw may be undone in several steps. If nil (the default), then it is undone in one step.</p></blockquote>

<p><em>evil-regexp-search</em> [Variable]</p>

<blockquote><p>t(default)，<code>/</code>，<code>?</code>使用正则表达式</p></blockquote>

<p><em>evil-search-wrap</em> [Variable]</p>

<blockquote><p>t(default)，<code>/</code>，<code>?</code>搜索是到底后从头再搜索。</p></blockquote>

<p><em>evil-flash-delay</em> [Variable]</p>

<blockquote><p>The number of seconds to flash search matches when pressing n and N.</p></blockquote>

<p><em>evil-want-C-i-jump</em> [Variable]</p>

<blockquote><p>If t (the default), then C-i jumps forwards in the jump list. If nil, then C-i inserts a tab.</p></blockquote>

<p><em>evil-want-C-u-scroll</em> [Variable]</p>

<blockquote><p>If t, then C-u scrolls the buffer. If nil (the default), then C-u begins a numeric prefix argument.</p></blockquote>

<h2>2.1 The cursor</h2>

<p>这个之前也已经涉及过，现在全面了解下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(setq evil-emacs-state-cursor '("red" box))
</span><span class='line'>(setq evil-normal-state-cursor '("green" box))
</span><span class='line'>(setq evil-insert-state-cursor '("orange" bar))</span></code></pre></td></tr></table></div></figure>


<p>一共这么多：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>evil-default-cursor
</span><span class='line'>  The default cursor.
</span><span class='line'>evil-normal-state-cursor
</span><span class='line'>  The cursor for Normal state.
</span><span class='line'>evil-insert-state-cursor
</span><span class='line'>  The cursor for Insert state.
</span><span class='line'>evil-visual-state-cursor
</span><span class='line'>  The cursor for Visual state.
</span><span class='line'>evil-replace-state-cursor
</span><span class='line'>  The cursor for Replace state.
</span><span class='line'>evil-operator-state-cursor
</span><span class='line'>  The cursor for Operator-Pending state.
</span><span class='line'>evil-motion-state-cursor
</span><span class='line'>  The cursor for Motion state.
</span><span class='line'>evil-emacs-state-cursor
</span><span class='line'>  The cursor for Emacs state.</span></code></pre></td></tr></table></div></figure>


<h2>2.2 The initial state</h2>

<p>默认是进入 Normal State。我也就不修改了。</p>

<h1>3 Keymaps</h1>

<p>Evil 的键映射存储在多个keymaps中，每个 state 有一个全局的 keymap，比如对应于Normal State 的<code>evil-normal-state-map</code>。
通过 Emacs 的 <code>define-key</code> 来修改。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>;; bind key "w" to command foo
</span><span class='line'>(define-key evil-normal-state-map "w" ’foo)</span></code></pre></td></tr></table></div></figure>


<p><code>evil-maps.el</code> 包含所有的键绑定。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>evil-normal-state-map
</span><span class='line'>  The global keymap for Normal state.
</span><span class='line'>evil-insert-state-map
</span><span class='line'>  The global keymap for Insert state.
</span><span class='line'>evil-visual-state-map
</span><span class='line'>  The global keymap for Visual state.
</span><span class='line'>evil-replace-state-map
</span><span class='line'>  The global keymap for Replace state.
</span><span class='line'>evil-operator-state-map
</span><span class='line'>  The global keymap for Operator-Pending state.
</span><span class='line'>evil-motion-state-map
</span><span class='line'>  The global keymap for Motion state.</span></code></pre></td></tr></table></div></figure>


<p>每个 state 还有一个 buffer-local 的 keymap。也就是特定于该 buffer，优先于 global keymap。这些可以通过 mode hook 修改。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>evil-normal-state-local-map
</span><span class='line'>  Buffer-local keymap for Normal state.
</span><span class='line'>evil-insert-state-local-map
</span><span class='line'>  Buffer-local keymap for Insert state.
</span><span class='line'>evil-visual-state-local-map
</span><span class='line'>  Buffer-local keymap for Visual state.
</span><span class='line'>evil-replace-state-local-map
</span><span class='line'>  Buffer-local keymap for Replace state.
</span><span class='line'>evil-operator-state-local-map
</span><span class='line'>  Buffer-local keymap for Operator-Pending state.
</span><span class='line'>evil-motion-state-local-map
</span><span class='line'>  Buffer-local keymap for Motion state.</span></code></pre></td></tr></table></div></figure>


<h2>3.1 ‘evil-define-key’</h2>

<p>Evil 提供的方法，可以往 Emacs 的 keymap 中添加特定 state 的键绑定。比如:</p>

<p>定义了一个 minor mode，叫做 foo-mode。然后往该 mode 的 normal state 下修改键绑定。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(define-minor-mode foo-mode
</span><span class='line'>       "Foo mode."
</span><span class='line'>       :keymap (make-sparse-keymap))
</span><span class='line'>     (evil-define-key ’normal foo-mode-map "w" ’bar)
</span><span class='line'>     (evil-define-key ’normal foo-mode-map "e" ’baz)</span></code></pre></td></tr></table></div></figure>


<p>然后用 hook，添加到 text-mode-hook 里。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(add-hook ’text-mode-hook ’foo-mode) ; enable alongside text-mode</span></code></pre></td></tr></table></div></figure>


<h2>Appendix 1</h2>

<p>什么是 vim 的 magic？</p>

<p>主要涉及到正则表达式。先留几个参考资料：</p>

<ol>
<li><a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html#/magic">vimdoc</a></li>
<li><a href="http://vim.wikia.com/wiki/Simplifying_regular_expressions_using_magic_and_no-magic">vim.vikia</a></li>
</ol>


<p><strong>To Be Continued</strong></p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>Strictly speaking, the order only matters if the variable affects the way Evil is loaded. This is the case with some of the ‘evil-want-’ variables.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linux Useful Tricks]]></title>
    <link href="http://poems.github.io/blog/2013/11/29/linux-useful-tricks/"/>
    <updated>2013-11-29T08:18:00+00:00</updated>
    <id>http://poems.github.io/blog/2013/11/29/linux-useful-tricks</id>
    <content type="html"><![CDATA[<h2>课后任务</h2>

<p>使用vagrant搭建Linux虚拟机</p>

<p><a href="http://docs.vagrantup.com/v2/getting-started/index.html">官方网址</a></p>

<p>1 首先安装 <a href="http://www.virtualbox.org/">virtualbox</a></p>

<p>2 安装<a href="http://docs.vagrantup.com/v2/installation/">vagrant</a></p>

<p>3 打开cmd，或者终端，运行以下命令，注意这一步会下载一个Linux发行版，大约3，400M吧。所以，你也可以用迅雷到网上下载下来，然后把 <code>http://files.vagrantup.com/precise32.box</code> 改成你文件的路径，比如我的是<code>file:///Users/pieux/Documents/o/precise32.box</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant init precise32 http://files.vagrantup.com/precise32.box
</span><span class='line'>$ vagrant up</span></code></pre></td></tr></table></div></figure>


<p>4 SSH 进入linux吧！<code>vagrant ssh</code>，退出就是 <code>exit</code></p>

<p>5 关闭Linux的命令是，休眠<code>vagrant suspend</code>，或者关闭<code>vagrant halt</code>。</p>

<h2>man 命令</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1    使用者在shell中可以操作的指令或可执行档
</span><span class='line'>2 系統核心可呼叫的函数与工具等
</span><span class='line'>3 一些常用的函数(function)与函数库(library)，大部分是C的函数库(libc)
</span><span class='line'>4 装置档案的说明，通常在/dev下的档案
</span><span class='line'>5 设定档或者是某些档案的格式
</span><span class='line'>6 游戏(games)
</span><span class='line'>7 惯例与协定等，例如Linux档案系统、网络协定、ASCII code等等的說明
</span><span class='line'>8 系統管理員可用的管理指令
</span><span class='line'>9 跟kernel有关的文件</span></code></pre></td></tr></table></div></figure>


<h2>tree 命令</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tree
</span><span class='line'>-a
</span><span class='line'>-A
</span><span class='line'>-C
</span><span class='line'>man tree</span></code></pre></td></tr></table></div></figure>


<h1>shell 快捷键</h1>

<p>编辑命令</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Ctrl + a ：移到命令行首
</span><span class='line'>Ctrl + e ：移到命令行尾
</span><span class='line'>Ctrl + f ：按字符前移（右向）
</span><span class='line'>Ctrl + b ：按字符后移（左向）
</span><span class='line'>Alt + f ：按单词前移（右向）
</span><span class='line'>Alt + b ：按单词后移（左向）
</span><span class='line'>Ctrl + u ：从光标处删除至命令行首
</span><span class='line'>Ctrl + k ：从光标处删除至命令行尾
</span><span class='line'>Ctrl + d ：删除光标处的字符
</span><span class='line'>Ctrl + y ：粘贴至光标后</span></code></pre></td></tr></table></div></figure>


<p>重新执行命令</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Ctrl + r：逆向搜索命令历史
</span><span class='line'>Ctrl + g：从历史搜索模式退出
</span><span class='line'>Ctrl + p：历史中的上一条命令
</span><span class='line'>Ctrl + n：历史中的下一条命令</span></code></pre></td></tr></table></div></figure>


<p>控制命令</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Ctrl + l：清屏
</span><span class='line'>Ctrl + s：阻止屏幕输出
</span><span class='line'>Ctrl + q：允许屏幕输出
</span><span class='line'>Ctrl + c：终止命令
</span><span class='line'>Ctrl + z：挂起命令</span></code></pre></td></tr></table></div></figure>


<h2>grep 命令</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grep
</span><span class='line'>-v 反选
</span><span class='line'>-E 正则
</span><span class='line'>-i 忽略大小写
</span><span class='line'>-n 加上行号</span></code></pre></td></tr></table></div></figure>


<p>简单的正则表达式：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>^ 行首
</span><span class='line'>$ 行尾
</span><span class='line'>. 任意字符
</span><span class='line'>* &gt;0个重复
</span><span class='line'>+ &gt;1个重复
</span><span class='line'>[Gg], [A-Za-z]
</span><span class='line'>\&lt; 单词首
</span><span class='line'>\&gt; 单词尾</span></code></pre></td></tr></table></div></figure>


<h2>进程相关</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ps -aux | grep process-name
</span><span class='line'>pgrep
</span><span class='line'>kill
</span><span class='line'>pkill
</span><span class='line'>killall</span></code></pre></td></tr></table></div></figure>


<h2>find</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>find -name
</span><span class='line'>find -not -name
</span><span class='line'>-i
</span><span class='line'>-type fdl
</span><span class='line'>-mindepth 3
</span><span class='line'>-maxdepth 3
</span><span class='line'>-exec ls -l {} \;
</span><span class='line'>| xargs ls -l</span></code></pre></td></tr></table></div></figure>


<h2>其他</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>touch 创建文件
</span><span class='line'>alias 别名
</span><span class='line'>history
</span><span class='line'>sudo !! 重执行上一条命令
</span><span class='line'>cd - 进入之前的目录
</span><span class='line'>wc
</span><span class='line'>chmod 
</span><span class='line'>du -hd 1
</span><span class='line'>du -h --max-depth=1
</span><span class='line'>Ctrl-Z 挂起
</span><span class='line'>fg 恢复
</span><span class='line'>&gt; .gitignore
</span><span class='line'>&lt; .gitignore
</span><span class='line'>mv filename.{old,new}
</span><span class='line'>rm !(*.foo|*.bar|*.baz)</span></code></pre></td></tr></table></div></figure>


<h2>git 相关</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git add -A
</span><span class='line'>git reset --soft
</span><span class='line'>git reset --mixed
</span><span class='line'>git reset --hard</span></code></pre></td></tr></table></div></figure>


<h2>学习资料推荐</h2>

<p><a href="http://www.commandlinefu.com/commands/tagged/800/commandfu">http://www.commandlinefu.com/commands/tagged/800/commandfu</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JRuby Small Memos]]></title>
    <link href="http://poems.github.io/blog/2013/11/27/jruby-small-memos/"/>
    <updated>2013-11-27T23:22:00+00:00</updated>
    <id>http://poems.github.io/blog/2013/11/27/jruby-small-memos</id>
    <content type="html"><![CDATA[<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ jruby --version</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ jruby -e "puts 'This is a short program'"
</span><span class='line'>This is a short program</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ jirb
</span><span class='line'>irb(main):001:0&gt; ['Hello', 'world'].join ' '
</span><span class='line'>=&gt; "Hello world"
</span><span class='line'>irb(main):002:0&gt; "ybuRJ morf".reverse
</span><span class='line'>=&gt; ufrom JRuby"
</span><span class='line'>irb(main):003:0&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ease Life with YASnippet]]></title>
    <link href="http://poems.github.io/blog/2013/11/24/ease-life-with-yasnippet/"/>
    <updated>2013-11-24T01:44:00+00:00</updated>
    <id>http://poems.github.io/blog/2013/11/24/ease-life-with-yasnippet</id>
    <content type="html"><![CDATA[<p>安装使用<code>package-install</code>，实际上可以写一个简易方法避免重复劳动：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(defun require-package (package)
</span><span class='line'>  "Install given PACKAGE."
</span><span class='line'>  (unless (package-installed-p package)
</span><span class='line'>    (unless (assoc package package-archive-contents)
</span><span class='line'>      (package-refresh-contents))
</span><span class='line'>    (package-install package)))
</span></code></pre></td></tr></table></div></figure>


<p>学习下其中的1个function</p>

<p><code>assoc</code> is a built-in function in `C source code&#8217;.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(assoc KEY LIST)</span></code></pre></td></tr></table></div></figure>


<p>Return non-nil if KEY is `equal&#8217; to the car of an element of LIST.
The value is actually the first element of LIST whose car equals KEY.</p>

<p>开始学习如何使用YASnippet。</p>

<p><strong>1 组织你的 Snippets</strong> (<em>Organizing Snippets</em>)</p>

<p>Snippet的定义是储存在文件系统的文件中。YASnippet的触发机制会找到这些snippet tables，然后展开。</p>

<p>首先，新建一个目录：my-snippets，用来存放自定义的snippets。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(require 'yasnippet)
</span><span class='line'>
</span><span class='line'>(setq yas-snippet-dirs (concat user-emacs-directory "my-snippets"))
</span><span class='line'>
</span><span class='line'>(add-hook 'prog-mode-hook 'yas-minor-mode)</span></code></pre></td></tr></table></div></figure>


<p>看下是怎么组织snippets的（这是YASnippet自带的）：</p>

<p><code>.yas.parent</code>文件可以共享其他目录下的snippets。</p>

<p>如果有一个空的<code>.yas-make-groups</code>文件，会在 YASnippet Menu按照目录结构组织地更清晰。</p>

<p><strong>2 展开你的 Snippets</strong> (<em>Traiggering expansion</em>)</p>

<p>很多中方式能展开snippets，包括：</p>

<ul>
<li><p>By typing an abbrev, the snippet trigger key, and then pressing the key defined in yas/trigger-key (which defaults to &ldquo;TAB&rdquo;). This works in buffers where the minor mode yas/minor-mode is active;</p></li>
<li><p>By invoking the command yas/insert-snippet (either by typing M-x yas/insert-snippet or its keybinding). This does not require yas/minor-mode to be active.</p></li>
<li><p>By using hippie-expand</p></li>
</ul>


<p>以上是3中最常见的方法（虽然我不知道什么是 hippie-expand）。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[macro &amp; defmacro in Emacs]]></title>
    <link href="http://poems.github.io/blog/2013/11/23/macro-and-defmacro-in-emacs/"/>
    <updated>2013-11-23T16:42:00+00:00</updated>
    <id>http://poems.github.io/blog/2013/11/23/macro-and-defmacro-in-emacs</id>
    <content type="html"><![CDATA[<p>学习下Lisp的宏（macro）。</p>

<p>首先，区别：Lisp宏和键盘宏（keyboard macro）是两个不同的概念。</p>

<p>一个LISP宏(Lisp Macro)是一个扩展LISP语言的用户定义的结构.
 宏不像函数那样对参数执行表达式. 它们只是在构造一个包括这些参数的表达式.</p>

<blockquote><p>也就是，宏是一个结构，是在构造。就是Lisp非常牛逼的一点：Code as data。</p></blockquote>

<p>首先看下语法定义：</p>

<p><code>defmacro</code> is a Lisp macro in `byte-run.el&#8217;.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(defmacro NAME ARGLIST &optional DOCSTRING DECL &rest BODY)</span></code></pre></td></tr></table></div></figure>


<p>Define NAME as a macro.
When the macro is called, as in (NAME ARGS&hellip;),
the function (lambda ARGLIST BODY&hellip;) is applied to
the list ARGS&hellip; as it appears in the expression,
and the result should be a form to be evaluated instead of the original.
DECL is a declaration, optional, of the form (declare DECLS&hellip;) where
DECLS is a list of elements of the form (PROP . VALUES).  These are
interpreted according to `macro-declarations-alist&#8217;.
The return value is undefined.</p>

<p>好长的解释。</p>

<p>看一个实例：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(defmacro inc (var)
</span><span class='line'>  (list 'setq var (list '1+ var)))
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>注意一点：<code>(list '1+ var)</code> 开始时写成<code>(list '1+var)</code>，少写了一个空格。</p></blockquote>

<p>定义了一个Lisp宏：<code>inc (var)</code>。这个macro的BODY是（按照list函数拼出来）:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(setq var (1+ var))</span></code></pre></td></tr></table></div></figure>


<p>当然也可以这样展开宏：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(macroexpand '(inc x))</span></code></pre></td></tr></table></div></figure>


<p>现在就可以用宏了：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(setq x 1)
</span><span class='line'>(inc x)</span></code></pre></td></tr></table></div></figure>


<blockquote><p>解释:</p></blockquote>

<p><code>list</code> 的用法</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>list is a built-in function in `C source code'.
</span><span class='line'>
</span><span class='line'>(list &rest OBJECTS)
</span><span class='line'>
</span><span class='line'>Return a newly created list with specified arguments as elements.
</span><span class='line'>Any number of arguments, even zero arguments, are allowed.
</span></code></pre></td></tr></table></div></figure>


<p>宏还有一种写法，就是使用反引用（Backquote）。</p>

<p>我们可以用 &lsquo; 引用一个对象并不执行.我们还可以用 反引用 ` 引用一个列表, 但是只是选择性的执行列表的元素.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A Growing Emacser]]></title>
    <link href="http://poems.github.io/blog/2013/11/23/a-growing-emacser/"/>
    <updated>2013-11-23T16:00:00+00:00</updated>
    <id>http://poems.github.io/blog/2013/11/23/a-growing-emacser</id>
    <content type="html"><![CDATA[<hr />

<p><code>when:</code> when is a lisp macro</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(when COND BODY...)</span></code></pre></td></tr></table></div></figure>


<p>If COND yields non-nil, do BODY, else return nil.
When COND yields non-nil, eval BODY forms sequentially and return
value of last one, or nil if there are none.</p>

<hr />

<p><code>fboundp</code> is a built-in function in `C source code&#8217;.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(fboundp SYMBOL)</span></code></pre></td></tr></table></div></figure>


<hr />

<p><code>add-to-list</code> is a compiled Lisp function in `subr.el&#8217;.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(add-to-list LIST-VAR ELEMENT &optional APPEND COMPARE-FN)</span></code></pre></td></tr></table></div></figure>


<p>Add ELEMENT to the value of <code>LIST-VAR</code> if it isn&rsquo;t there yet.
The test for presence of <code>ELEMENT</code> is done with <code>equal</code>,
or with <code>COMPARE-FN</code> if that&rsquo;s non-nil.
If <code>ELEMENT</code> is added, it is added at the beginning of the list,
unless the optional argument <code>APPEND</code> is non-nil, in which case
ELEMENT is added at the end.</p>

<p>The return value is the new value of LIST-VAR.</p>

<hr />

<p><code>provide</code> is a built-in function in `C source code&#8217;.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(provide FEATURE &optional SUBFEATURES)</span></code></pre></td></tr></table></div></figure>


<p>Announce that FEATURE is a feature of the current Emacs.
The optional argument SUBFEATURES should be a list of symbols listing
particular subfeatures supported in this version of FEATURE.</p>

<hr />

<p><code>C-x h</code> runs the command mark-whole-buffer</p>

<p><code>C-w</code> runs the command kill region</p>

<hr />

<p>use <code>C-x &lt;right&gt;</code>, <code>C-x &lt;left&gt;</code> to cycle around in the buffer ring.</p>

<p><code>iswitchb-mode</code> replaces the default C-x b behaviour with a very intuitive buffer-switching-with-completion system.</p>

<p>The related commands are <code>C-x b</code>, <code>C-s</code> and <code>C-r</code>.</p>

<hr />

<p>Dired Mode 非常别扭，很多无用的快捷键。</p>

<p>emacs <code>dired</code> (Directory Editor)mode.</p>

<p><code>C-x d</code>: enter dired mode(use <code>M-x RET dired RET</code> is quick too)</p>

<p><code>C-x 4 d</code>: <code>dired-other-window</code></p>

<p><code>C-x C-j</code>: (dired-jump to current file)</p>

<p><code>q</code>: quit</p>

<p><code>R</code> to rename the file (or &lsquo;dired-do-rename&rsquo;).</p>

<p><code>C-x k RET</code> to go back to the (renamed) buffer</p>

<hr />
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A example of writing Exception in java]]></title>
    <link href="http://poems.github.io/blog/2013/11/23/a-example-of-writing-exception-in-java/"/>
    <updated>2013-11-23T07:49:00+00:00</updated>
    <id>http://poems.github.io/blog/2013/11/23/a-example-of-writing-exception-in-java</id>
    <content type="html"><![CDATA[<p>记录在阅读 Jasig Cas 的源码学习到的 Java 知识。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public abstract class AuthenticationException extends Exception {
</span></code></pre></td></tr></table></div></figure>


<p>首先，这是一个 abstract class.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/** The code to return for resolving to a message description. */
</span><span class='line'>private String code;
</span><span class='line'>
</span><span class='line'>/**
</span><span class='line'> * Method to return the unique identifier for this error type.
</span><span class='line'> *
</span><span class='line'> * @return the String identifier for this error type.
</span><span class='line'> */
</span><span class='line'>public final String getCode() {
</span><span class='line'>    return this.code;
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>使用 code，来解析异常消息的描述。
并且，code 有一个 get 方法，final 不可继承。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/** The error type that provides additional info about the nature of the exception cause **/
</span><span class='line'>private String type = "error";
</span><span class='line'>
</span><span class='line'>/**
</span><span class='line'> * Method to return the error type of this exception
</span><span class='line'> *
</span><span class='line'> * @return the String identifier for the cause of this error.
</span><span class='line'> */
</span><span class='line'>public final String getType() {
</span><span class='line'>    return this.type;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>额外的一个 field: type，维护导致异常的本质信息。</p>

<p>下面是 <code>AuthenticationException</code> 的 constructors。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public AuthenticationException(final String code) {
</span><span class='line'>    this.code = code;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>这是第1个 constructor。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public AuthenticationException(final String code, final String msg) {
</span><span class='line'>    super(msg);
</span><span class='line'>    this.code = code;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>public AuthenticationException(final String code, final String msg, final String type) {
</span><span class='line'>    super(msg);
</span><span class='line'>    this.code = code;
</span><span class='line'>    this.type = type;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>第2个和第3个 constructor，需要学习的是 <code>super(msg)</code>。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/**
</span><span class='line'> * Constructor that takes a code description of the error and the chained
</span><span class='line'> * exception. These codes normally have a corresponding entries in the
</span><span class='line'> * messages file for the internationalization of error messages.
</span><span class='line'> *
</span><span class='line'> * @param code The short unique identifier for this error.
</span><span class='line'> * @param throwable The chained exception for this AuthenticationException
</span><span class='line'> */
</span><span class='line'>public AuthenticationException(final String code, final Throwable throwable) {
</span><span class='line'>    super(throwable);
</span><span class='line'>    this.code = code;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>最后一个 constructor，需要学习的是 <code>final Throwable throwable</code>，这块不是很懂。按描述是能链式异常。
查看了 <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html#Exception(java.lang.Throwable)">Java Exception 文档</a>，它有一个 constructor：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public Exception(Throwable cause)</span></code></pre></td></tr></table></div></figure>


<p>它的作用是：用指定的 cause 和 详细的 message(<code>cause==null ? null : cause.toString()</code>)构造新的异常。
它的作用就是一个 &ldquo;wrapper&#8221;。</p>

<p>完整源码见：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/*
</span><span class='line'> * Licensed to Jasig under one or more contributor license
</span><span class='line'> * agreements. See the NOTICE file distributed with this work
</span><span class='line'> * for additional information regarding copyright ownership.
</span><span class='line'> * Jasig licenses this file to you under the Apache License,
</span><span class='line'> * Version 2.0 (the "License"); you may not use this file
</span><span class='line'> * except in compliance with the License.  You may obtain a
</span><span class='line'> * copy of the License at the following location:
</span><span class='line'> *
</span><span class='line'> *   http://www.apache.org/licenses/LICENSE-2.0
</span><span class='line'> *
</span><span class='line'> * Unless required by applicable law or agreed to in writing,
</span><span class='line'> * software distributed under the License is distributed on an
</span><span class='line'> * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
</span><span class='line'> * KIND, either express or implied.  See the License for the
</span><span class='line'> * specific language governing permissions and limitations
</span><span class='line'> * under the License.
</span><span class='line'> */
</span><span class='line'>package org.jasig.cas.authentication.handler;
</span><span class='line'>
</span><span class='line'>/**
</span><span class='line'> * The most generic type of authentication exception that one can catch if not
</span><span class='line'> * sure what specific implementation will be thrown. Top of the tree of all
</span><span class='line'> * other AuthenticationExceptions.
</span><span class='line'> *
</span><span class='line'> * @author Scott Battaglia
</span><span class='line'> * @version $Revision$ $Date$
</span><span class='line'> * @since 3.0
</span><span class='line'> */
</span><span class='line'>public abstract class AuthenticationException extends Exception {
</span><span class='line'>
</span><span class='line'>    /** Serializable ID. */
</span><span class='line'>    private static final long serialVersionUID = 3906648604830611762L;
</span><span class='line'>
</span><span class='line'>    /** The code to return for resolving to a message description. */
</span><span class='line'>    private String code;
</span><span class='line'>
</span><span class='line'>    /** The error type that provides additional info about the nature of the exception cause **/
</span><span class='line'>    private String type = "error";
</span><span class='line'>
</span><span class='line'>    /**
</span><span class='line'>     * Constructor that takes a code description of the error. These codes
</span><span class='line'>     * normally have a corresponding entries in the messages file for the
</span><span class='line'>     * internationalization of error messages.
</span><span class='line'>     *
</span><span class='line'>     * @param code The short unique identifier for this error.
</span><span class='line'>     */
</span><span class='line'>    public AuthenticationException(final String code) {
</span><span class='line'>        this.code = code;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    /**
</span><span class='line'>     * Constructor that takes a &lt;code&gt;code&lt;/code&gt; description of the error along with the exception
</span><span class='line'>     * &lt;code&gt;msg&lt;/code&gt; generally for logging purposes. These codes normally have a corresponding
</span><span class='line'>     * entries in the messages file for the internationalization of error messages.
</span><span class='line'>     *
</span><span class='line'>     * @param code The short unique identifier for this error.
</span><span class='line'>     * @param msg The error message associated with this exception for additional logging purposes.
</span><span class='line'>     */
</span><span class='line'>    public AuthenticationException(final String code, final String msg) {
</span><span class='line'>        super(msg);
</span><span class='line'>        this.code = code;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    /**
</span><span class='line'>     * Constructor that takes a &lt;code&gt;code&lt;/code&gt; description of the error along with the exception
</span><span class='line'>     * &lt;code&gt;msg&lt;/code&gt; generally for logging purposes and the &lt;code&gt;type&lt;/code&gt; of the error that originally caused the exception.
</span><span class='line'>     * These codes normally have a corresponding entries in the messages file for the internationalization of error messages.
</span><span class='line'>     *
</span><span class='line'>     * @param code The short unique identifier for this error.
</span><span class='line'>     * @param msg The error message associated with this exception for additional logging purposes.
</span><span class='line'>     * @param type The type of the error message that caused the exception to be thrown. By default,
</span><span class='line'>     * all errors are considered of &lt;code&gt;error&lt;/code&gt;.
</span><span class='line'>     */
</span><span class='line'>    public AuthenticationException(final String code, final String msg, final String type) {
</span><span class='line'>        super(msg);
</span><span class='line'>        this.code = code;
</span><span class='line'>        this.type = type;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    /**
</span><span class='line'>     * Constructor that takes a code description of the error and the chained
</span><span class='line'>     * exception. These codes normally have a corresponding entries in the
</span><span class='line'>     * messages file for the internationalization of error messages.
</span><span class='line'>     *
</span><span class='line'>     * @param code The short unique identifier for this error.
</span><span class='line'>     * @param throwable The chained exception for this AuthenticationException
</span><span class='line'>     */
</span><span class='line'>    public AuthenticationException(final String code, final Throwable throwable) {
</span><span class='line'>        super(throwable);
</span><span class='line'>        this.code = code;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    /**
</span><span class='line'>     * Method to return the error type of this exception
</span><span class='line'>     *
</span><span class='line'>     * @return the String identifier for the cause of this error.
</span><span class='line'>     */
</span><span class='line'>    public final String getType() {
</span><span class='line'>        return this.type;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    /**
</span><span class='line'>     * Method to return the unique identifier for this error type.
</span><span class='line'>     *
</span><span class='line'>     * @return the String identifier for this error type.
</span><span class='line'>     */
</span><span class='line'>    public final String getCode() {
</span><span class='line'>        return this.code;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public final String toString() {
</span><span class='line'>        String msg = getCode();
</span><span class='line'>        if (getMessage() != null && getMessage().trim().length() &gt; 0)
</span><span class='line'>            msg = ":" + getMessage();
</span><span class='line'>        return msg;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A Blank Page for Test]]></title>
    <link href="http://poems.github.io/blog/2013/11/02/a-blank-page-for-test/"/>
    <updated>2013-11-02T11:23:00+00:00</updated>
    <id>http://poems.github.io/blog/2013/11/02/a-blank-page-for-test</id>
    <content type="html"><![CDATA[<h1>A Blank Page for Test</h1>
]]></content>
  </entry>
  
</feed>
